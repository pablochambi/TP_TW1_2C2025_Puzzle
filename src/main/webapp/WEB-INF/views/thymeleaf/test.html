<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Sudoku Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        input.own { background: lightgreen; }
        input.rival { background: lightcoral; }
    </style>
</head>
<body>
<h2>Sudoku Test</h2>
<table id="puzzle">
    <tr><td><input data-row="0" data-col="0" oninput="handleInput(this)"></td><td><input data-row="0" data-col="1" oninput="handleInput(this)"></td></tr>
    <tr><td><input data-row="1" data-col="0" oninput="handleInput(this)"></td><td><input data-row="1" data-col="1" oninput="handleInput(this)"></td></tr>
</table>

<script>
    let stompClient;

    function connect() {
        const socket = new SockJS('/spring/sudoku-ws');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function(frame) {
            console.log('âœ… Connected:', frame);
            stompClient.subscribe('/topic/updates', function(message) {
                const update = JSON.parse(message.body);
                updateCell(update.row, update.col, update.color);
            });
        });
    }

    function handleInput(input) {
        const row = input.dataset.row;
        const col = input.dataset.col;
        input.classList.add("own");
        stompClient.send("/app/cell-update", {}, JSON.stringify({
            row: row, col: col, color: "rival"
        }));
    }

    function updateCell(row, col, color) {
        const input = document.querySelector(`input[data-row='${row}'][data-col='${col}']`);
        input.classList.add(color);
        setTimeout(() => input.classList.remove(color), 1500);
    }

    document.addEventListener("DOMContentLoaded", connect);
</script>
</body>
</html>